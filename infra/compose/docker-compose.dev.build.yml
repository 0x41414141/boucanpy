version: '3.3'
services:
  bountydns:
    build:
      context: ./../../
      dockerfile: ./infra/docker/bountydns.dockerfile
    image: 3lpsy/bountydns:latest
    networks:
      bountydnspub:
    command: api-server --debug --reload --no-envs --db-setup -l 0.0.0.0 --db-seed-env
    depends_on:
      - db
      - broadcast
  dns:
    image: 3lpsy/bountydns:latest
    networks:
      bountydnspub:
    command: dns-server -l 0.0.0.0 -p 53
    restart: on-failure:2
    depends_on:
      - bountydns
      - broadcast
      - proxy
  webui:
    build:
      context: ./../../bountydns
      dockerfile: ./../infra/docker/webui.dockerfile
    image: 3lpsy/bountydns-webui:latest
    networks:
      bountydnspub:
  proxy:
    build:
      context: ./../proxy
      dockerfile: ./../docker/proxy.dockerfile
    image: 3lpsy/bountydns-proxy:latest
    networks:
      bountydnspub:
    depends_on:
      - webui
      - bountydns
  broadcast:
    build:
      context: ./../broadcast
      dockerfile: ./../docker/broadcast.dockerfile
    image: 3lpsy/bountydns-broadcast:latest
    networks:
      bountydnspub:
    restart: on-failure:5

  db:
    image: postgres:latest
    networks:
      bountydnspub:
  # dbui:
  #   image: dpage/pgadmin4
  # search:
  #   image: amazon/opendistro-for-elasticsearch:latest
